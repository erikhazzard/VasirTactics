/*=======================================
Something
========================================= */
((function(){" ========================================================================    \n namespace.js\n ----------------------\nSets up the namespace for our game, along with setting up any global\n    util functions\n ========================================================================";var a,b=this;a=function(){return{events:_.extend({},Backbone.Events),Views:{},Models:{},Collections:{},game:void 0,userInterface:void 0,logger:void 0,init:void 0,util:void 0,templates:{}}}(),window.GAME_NAME=a," ========================================================================    \n\nGlobal Util Functions\n\n========================================================================",window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){return window.setTimeout(a,1e3/60)}}()})).call(this),function(){" ========================================================================    \n\nLogging System\n    \n======================================================================== ";var a;window.GAME_NAME.logger=window.GAME_NAME.logger||{},a=window.GAME_NAME.logger,a.options={log_level:"all"},a.history={},a.can_log=function(b){"This function takes in a type (e.g., 'warn') and checks to see if\nit exists in the logger.options.log_level option";var c,d;return d=!1,c=a.options.log_level,c==="all"||c===!0?d=!0:c instanceof Array?c.indexOf(b)>-1&&(d=!0):c===null||c===void 0||c==="none"||c===!1?d=!1:c===b&&(d=!0),d},a.log=function(b){"When using logger.log, you must pass in a type\ne.g.\n    logger.debug( arg1, arg2, etc. )";var c,d,e;c=Array.prototype.slice.call(arguments);if(b==null||arguments.length===1)b="debug",c.splice(0,0,"debug");return a.can_log(b)?(d=new Date,c.push({Date:d,Milliseconds:d.getMilliseconds(),Time:d.getTime()}),e=a.history,e[b]=e[b]||[],e[b].push(c),window.console&&console.log(Array.prototype.slice.call(c)),!0):!1},a.options.log_types=["debug","error","info","warn"],a.options.setup_log_types=function(){"This function will setup log types based on the ones available in\nlogger.options.log_types.  It can be called whenever to \ndynamically add log types";var b,c,d,e,f;e=a.options.log_types,f=[];for(c=0,d=e.length;c<d;c++)b=e[c],f.push(function(b){return a[b]=function(){var c;return c=Array.prototype.slice.call(arguments),c.splice(0,0,b),a.log.apply(null,c)}}(b));return f},a.options.setup_log_types()," ========================================================================    \nConfigure console.log\n======================================================================== ",window.console&&a.options&&(a.options.log_level==="none"||a.options.log_level===null)&&(console.log=function(){return{}}),window.console==null&&(window.console={log:function(){return{}}}),window.onerror=function(b,c,d){return a.error(b,c,d),!1}}.call(this),function(){" ========================================================================    \ncreature.coffee\n\nContains the class definitions for creatures\n\n======================================================================== "," ========================================================================    \nAdd logging types\n======================================================================== ";var a=this;GAME_NAME.logger.options.log_types.push("Util"),GAME_NAME.logger.options.setup_log_types()," ========================================================================    \n\nUtils\n\n======================================================================== ",GAME_NAME.util=function(){var a;return a=function(a){return console.log(a)},{delegateSVGEvents:a}}()}.call(this),function(){" ========================================================================    \ngame.coffee\n\nCotains the Game model.  A game is instaniated in init and contains\na map, renderer, reference to players, creatures, etc.\n\n======================================================================== "," ========================================================================    \nAdd logging types\n======================================================================== ";var a=function(a,b){return function(){return a.apply(b,arguments)}},b=Object.prototype.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};GAME_NAME.logger.options.log_types.push("Game"),GAME_NAME.logger.options.setup_log_types()," ========================================================================    \n\nModel    \n\n======================================================================== ",GAME_NAME.Models.Game=function(b){function d(){this.getMap=a(this.getMap,this),this.initialize=a(this.initialize,this),d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.defaults={id:"game_name_01",players:{playerID:{},playerID2:{}},activePlayer:void 0,map:{},renderer:{},_state:{}},d.prototype.initialize=function(){"Set everything up";var a;return a={},a.userInterface=new GAME_NAME.Models.UserInterface,a.userInterfaceView=new GAME_NAME.Views.UserInterface({model:a.userInterface}),a.userInterfaceView.render(),a.map=new GAME_NAME.Models.Map,a.renderer=new GAME_NAME.Views.Renderer({game:this}),this.set(a),this},d.prototype.getMap=function(){return"This function will get the map from the server"},d}(Backbone.Model)}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=Object.prototype.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};GAME_NAME.logger.options.log_types.push("Cell"),GAME_NAME.logger.options.setup_log_types(),GAME_NAME.Views.Cell=function(b){function d(){this.handleSpell=a(this.handleSpell,this),this.targetHtml=a(this.targetHtml,this),this.mouseLeave=a(this.mouseLeave,this),this.mouseEnter=a(this.mouseEnter,this),this.target=a(this.target,this),this.click=a(this.click,this),this.enableCell=a(this.enableCell,this),this.render=a(this.render,this),this.delegateSVGEvents=a(this.delegateSVGEvents,this),this.initialize=a(this.initialize,this),d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.events={click:"click",mouseover:"mouseEnter",mouseout:"mouseLeave"},d.prototype.initialize=function(){return"This cell view is created in Renderer",this.options.model===void 0||this.options.cellSize===void 0||this.options.group===void 0?(GAME_NAME.logger.error("ERROR","cell view: params not properly passed in"),!1):(this.model=this.options.model,this.model.on("cell:targeted",this.target),this.model.on("cell:enableCell",this.enableCell),this.model.on("spell:cast",this.handleSpell),this.cellSize=this.options.cellSize,this.group=this.options.group,this.x=this.model.get("x")*this.cellSize.width,this.y=this.model.get("y")*this.cellSize.height,this.userInterface=GAME_NAME.game.get("userInterface"),this.el={},this)},d.prototype.delegateSVGEvents=function(){var a,b,c;c=this.events;for(a in c)b=c[a],this.d3El.on(a,this[b]);return this},d.prototype.render=function(a){var b;return a=a||{},a.renderer===void 0?(GAME_NAME.logger.error("ERROR","cell render(): renderer not passed in"),!1):(b=this.group.append("svg:g").attr("class","cellGroup cellGroup_"+this.x+","+this.y).attr("transform","translate("+[this.x,this.y]+")"),this.baseSprite=b.append("svg:image").attr("class","map_tile_image").attr("x",0).attr("y",0).attr("width",this.options.cellSize.width).attr("height",this.options.cellSize.height).attr("xlink:href",a.renderer.get("sprites")[this.model.get("baseSprite")]),this.model.get("topSprite")&&(this.topSprite=b.append("svg:image").attr("class","map_tile_image_overlay").attr("x",0).attr("y",0).attr("width",this.options.cellSize.width).attr("height",this.options.cellSize.height).attr("xlink:href",a.renderer.get("sprites")[this.model.get("topSprite")])),this.cellRect=b.append("svg:rect").attr("class","map_tile tile_"+this.x+","+this.y).attr("x",0).attr("y",0).attr("width",this.options.cellSize.width).attr("height",this.options.cellSize.height),this.el=b.node(),this.d3El=b,this.delegateSVGEvents())},d.prototype.enableCell=function(){return this.cellRect.classed("tile_disabled",!1),this.model.set({cellEnabled:!0})},d.prototype.click=function(){var a,b;return a=!1,b=!1,console.log(this.userInterface.get("targetMode")),this.userInterface.get("target")||(a=!0),this.userInterface.get("target")&&(this.userInterface.get("target").get("className")==="cell"&&(a=!0),this.userInterface.get("target")===this.model||!this.model.get("cellEnabled")?(a=!1,this.userInterface.set({target:void 0})):this.userInterface.get("target").get("className")==="creature"&&(this.userInterface.get("target").belongsToActivePlayer()?(a=!1,b=!0):a=!0)),a&&this.userInterface.set({target:this.model,targetHtml:this.targetHtml()}),b&&this.userInterface.get("target").trigger("creature:move",{cell:this.model}),a},d.prototype.target=function(){var a;return a=this.d3El.select("rect"),a.classed("map_tile_selected",!0),this},d.prototype.mouseEnter=function(){return this.cellRect.classed("map_tile_mouse_over",!0),this},d.prototype.mouseLeave=function(){return this.cellRect.classed("map_tile_mouse_over",!1),this},d.prototype.targetHtml=function(){var a;return a=_.template(GAME_NAME.templates.target_cell)({model:this.model}),a},d.prototype.handleSpell=function(a){return a=a||{},a.spell||visually.logger.error("cell:handleSpell():","no spell passed into handleSpell","params: ",a),a.spell.get("effect")({target:this.d3El,model:this.model}),this},d}(Backbone.View),GAME_NAME.Models.Cell=function(b){function d(){this.target=a(this.target,this),this.initialize=a(this.initialize,this),d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.defaults={name:"cell_i,j",className:"cell",x:0,y:0,baseSprite:"",topSprite:"",type:"0",graphic:"",cellEnabled:!1},d.prototype.initialize=function(){return this},d.prototype.target=function(){return this.trigger("cell:targeted"),this},d}(Backbone.Model)}.call(this),function(){" ========================================================================    \ncreature.coffee\n\nContains the class definitions for creatures\n\n======================================================================== "," ========================================================================    \nAdd logging types\n======================================================================== ";var a=function(a,b){return function(){return a.apply(b,arguments)}},b=Object.prototype.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};GAME_NAME.logger.options.log_types.push("Creature"),GAME_NAME.logger.options.setup_log_types()," ========================================================================    \n\nVIEW \n\n======================================================================== ",GAME_NAME.Views.Creature=function(b){function d(){this.creatureDeath=a(this.creatureDeath,this),this.handleSpell=a(this.handleSpell,this),this.updateTargetHtml=a(this.updateTargetHtml,this),this.mouseLeave=a(this.mouseLeave,this),this.mouseEnter=a(this.mouseEnter,this),this.target=a(this.target,this),this.creatureClicked=a(this.creatureClicked,this),this.update=a(this.update,this),this.render=a(this.render,this),this.delegateSVGEvents=a(this.delegateSVGEvents,this),this.initialize=a(this.initialize,this),d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.events={click:"creatureClicked"},d.prototype.initialize=function(){return"This creature view is created in Renderer",this.options.model===void 0||this.options.game===void 0||this.options.group===void 0?(GAME_NAME.logger.error("ERROR","creature view init(): params not properly passed in"),!1):(this.model=this.options.model,this.game=this.options.game,this.map=this.options.game.get("map"),this.renderer=this.options.game.get("renderer"),this.cellSize=this.renderer.model.get("cellSize"),this.group=this.options.group,this.userInterface=GAME_NAME.game.get("userInterface"),this.model.on("creature:targeted",this.target),this.model.on("change:location",this.update),this.model.on("change:location",this.target),this.model.on("creature:death",this.creatureDeath),this.model.on("spell:cast",this.handleSpell),this.model.on("change:movesLeft",this.updateTargetHtml),this.model.on("change:health",this.updateTargetHtml),this.el={},this)},d.prototype.delegateSVGEvents=function(){var a,b,c;c=this.events;for(a in c)b=c[a],this.d3El.on(a,this[b]);return this},d.prototype.render=function(a){"Handles the actual rendering / drawing of the creature";var b,c;return this.x=this.model.get("location").x*this.cellSize.width,this.y=this.model.get("location").y*this.cellSize.height,c=this.group.append("svg:g").attr("class","creature_"+this.model.cid).attr("transform","translate("+[this.x,this.y]+")"),b=c.append("svg:rect").attr("class","creature_background_rect").attr("x",0).attr("y",0).attr("rx",6).attr("ry",6).attr("width",this.cellSize.width).attr("height",this.cellSize.height),c.append("svg:image").attr("x",0).attr("y",0).attr("width",this.cellSize.width).attr("height",this.cellSize.height).attr("xlink:href",this.renderer.model.get("sprites")[this.model.get("sprite")]),this.el=c.node(),this.d3El=c,this.delegateSVGEvents(),this},d.prototype.update=function(){return this.x=this.model.get("location").x*this.cellSize.width,this.y=this.model.get("location").y*this.cellSize.height,this.d3El.transition().duration(900).attr("transform","translate("+[this.x,this.y]+")")},d.prototype.creatureClicked=function(){return"Fired off when the user clicks on a creature",this.userInterface.get("target")===this.model?this.userInterface.set({target:void 0}):(this.userInterface.set({target:this.model}),this.updateTargetHtml()),this},d.prototype.target=function(){var a,b,c,d,e,f,g,h,i,j,k,l=this;c=this.model.get("location").x,d=this.model.get("location").y,i=d3.selectAll(".map_tile_selected").classed("map_tile_selected",!1),h=this.d3El.select("rect"),h.classed("map_tile_selected",!0);if(!this.model.canUpdateTargetUI())return this;g=d3.selectAll(".map_tile").classed("tile_disabled",!0),b=this.map.get("cells"),_.each(b,function(a){return a.set({cellEnabled:!1})}),e=this.model.calculateMovementCells(),f=this.map.get("cells");for(j=0,k=e.length;j<k;j++)a=e[j],f[a.get("x")+","+a.get("y")].trigger("cell:enableCell"),a.set({cellEnabled:!0});return GAME_NAME.logger.log("Creature","Creature - Target - enabled and disabled cells"),this},d.prototype.mouseEnter=function(){var a;return a=this.d3El.select("rect"),a.classed("map_tile_mouse_over",!0),this},d.prototype.mouseLeave=function(){var a;return a=this.d3El.select("rect"),a.classed("map_tile_mouse_over",!1),this},d.prototype.updateTargetHtml=function(){var a;return a="",this.model!==this.userInterface.get("target")?!1:(this.model.belongsToActivePlayer()?a=_.template(GAME_NAME.templates.target_creature_mine)({model:this.model}):a=_.template(GAME_NAME.templates.target_creature_theirs)({model:this.model}),this.userInterface.set({targetHtml:a}),this)},d.prototype.handleSpell=function(a){return a=a||{},a.spell||visually.logger.error("creature:handleSpell():","no spell passed into handleSpell","params: ",a),a.spell.get("effect")({target:this.d3El,model:this.model}),this},d.prototype.creatureDeath=function(){return this.d3El.selectAll("*").transition().duration(1e3).style("opacity",0).delay(1500).remove(),this.model===this.userInterface.get("target")&&this.userInterface.set({target:void 0}),this},d}(Backbone.View)," ========================================================================    \n\nModel    \n\n======================================================================== ",GAME_NAME.Models.Creature=function(b){function d(){this.turnEnd=a(this.turnEnd,this),this.canMove=a(this.canMove,this),this.move=a(this.move,this),this.calculateMovementCells=a(this.calculateMovementCells,this),this.canUpdateTargetUI=a(this.canUpdateTargetUI,this),this.target=a(this.target,this),this.belongsToActivePlayer=a(this.belongsToActivePlayer,this),this.dealDamage=a(this.dealDamage,this),this.creatureDeath=a(this.creatureDeath,this),this.checkForDeath=a(this.checkForDeath,this),this.initialize=a(this.initialize,this),d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.defaults={name:"Toestubber",className:"creature",attack:1,health:2,target:{},effects:[],abilities:[],type:["human"],moves:3,movesLeft:void 0,location:{x:Math.round(Math.random()*5),y:Math.round(Math.random()*5)},sprite:"creature_dragoon",passType:"ground",owner:void 0},d.prototype.initialize=function(){return this.get("movesLeft")===void 0&&this.set({movesLeft:this.get("moves")}),this.on("creature:move",this.move),this.on("change:health",this.checkForDeath),this.on("creature:death",this.creatureDeath),this.on("creature:turn:end",this.turnEnd),this},d.prototype.checkForDeath=function(a){if(this.get("health")<1)return this.trigger("creature:death")},d.prototype.creatureDeath=function(){return GAME_NAME.logger.Creature("Creature died!","creature: "+this.get("name"),"model: ",this)},d.prototype.dealDamage=function(a){var b;return typeof a=="number"&&(a={amount:a}),a=a||{},a.amount?(b=a.amount,this.set({health:this.get("health")-b})):(GAME_NAME.logger.error("creature model: dealDamage()","no amount passed in"),!1)},d.prototype.belongsToActivePlayer=function(){var a;return a=GAME_NAME.game.get("activePlayer").get("creatures").indexOf(this),a>-1?!0:!1},d.prototype.target=function(){return this.trigger("creature:targeted"),this},d.prototype.canUpdateTargetUI=function(){return this.belongsToActivePlayer()&&this===GAME_NAME.game.get("userInterface").get("target")?!0:!1},d.prototype.calculateMovementCells=function(a){var b,c,d,e,f,g,h,i,j;a=a||{},b=a.cells||GAME_NAME.game.get("map").get("cells"),h=[],c=this.get("location"),i=this.get("movesLeft"),g=i,j=-i;for(e=j;j<=g?e<=g:e>=g;j<=g?e++:e--)for(f=j;j<=g?f<=g:f>=g;j<=g?f++:f--)d=b[c.x+e+","+(c.y+f)],d!==void 0&&this.canMove({cell:d})&&h.push(d);return h},d.prototype.move=function(a){var b,c,d,e,f;return a=a||{},b=a.cell,b?this.calculateMovementCells().indexOf(b)<0?this:this.belongsToActivePlayer()?(d=Math.abs(this.get("location").x-b.get("x")),e=Math.abs(this.get("location").y-b.get("y")),d>e?c=d:c=e,f=this.get("movesLeft")-c,this.set({location:{x:b.get("x"),y:b.get("y")},movesLeft:f}),this):this:(GAME_NAME.logger.error("creature model: move(): no cell passed into params"),!1)},d.prototype.canMove=function(a){var b,c;return a=a||{},c=a.cell,c||GAME_NAME.logger.error("creature model: move(): no cell passed into params"),b=!1,c.get("canPass")==="all"||c.get("canPass")===this.get("passType")?b=!0:b=!1,b},d.prototype.turnEnd=function(){return this.set({movesLeft:this.get("moves")},{silent:!0})},d}(Backbone.Model)," ========================================================================    \n\nColections\n\n======================================================================== ",GAME_NAME.Collections.Creatures=function(b){function d(){this.turnEnd=a(this.turnEnd,this),this.turnBegin=a(this.turnBegin,this),this.initialize=a(this.initialize,this),d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.model=GAME_NAME.Models.Creature,d.prototype.initialize=function(){return this.on("creatures:turn:end",this.turnEnd),this.on("creatures:turn:begin",this.turnBegin)},d.prototype.turnBegin=function(){var a,b,c,d,e;d=this.models,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(a.trigger("creature:turn:begin"));return e},d.prototype.turnEnd=function(){var a,b,c,d,e;d=this.models,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(a.trigger("creature:turn:end"));return e},d}(Backbone.Collection)}.call(this),function(){" ========================================================================    \nuser-interface.coffee\n\nCotains the game's Interface.  The userInterface controls all user \ninteraciton with the game / UI\n\n======================================================================== "," ========================================================================    \nAdd logging types\n======================================================================== ";var a=function(a,b){return function(){return a.apply(b,arguments)}},b=Object.prototype.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};GAME_NAME.logger.options.log_types.push("UserInterface"),GAME_NAME.logger.options.setup_log_types()," ========================================================================    \n\nVIEW \n\n======================================================================== ",GAME_NAME.Views.UserInterface=function(b){function d(){this.changeMana=a(this.changeMana,this),this.renderTarget=a(this.renderTarget,this),this.unTargetTiles=a(this.unTargetTiles,this),this.target=a(this.target,this),this.endTurn=a(this.endTurn,this),this.render=a(this.render,this),this.initialize=a(this.initialize,this),d.__super__.constructor.apply(this,arguments)}return c(d,b),"Renders the interface and handles firing off / listening for events",d.prototype.initialize=function(){return this.model=this.options.model,this.model.on("change:target",this.target),this.model.on("change:targetHtml",this.renderTarget),this.model.on("change:manaHtml",this.changeMana),$("#game_actions_wrapper .end_turn").click(this.endTurn),this.$targetEl=$("#game_target_wrapper .game_target"),this.$manaEl=$("#game_player_mana_wrapper .mana_amount"),this},d.prototype.render=function(){return this},d.prototype.endTurn=function(){return GAME_NAME.game.get("activePlayer").trigger("turn:end"),GAME_NAME.game.get("activePlayer").get("creatures").trigger("creatures:turn:end"),this.model.set({target:void 0}),this},d.prototype.target=function(){var a;return a=this.model.get("target"),this.unTargetTiles(),GAME_NAME.logger.log("UserInterface","target()","Current target:",this.model.get("target")),a!==void 0?a.target():this.model.set({targetHtml:""}),this},d.prototype.unTargetTiles=function(){var a,b=this;return d3.select(".map_tile_selected").classed("map_tile_selected",!1),d3.selectAll(".tile_disabled").classed("tile_disabled",!1),a=GAME_NAME.game.get("map").get("cells"),_.each(a,function(a){return a.set({cellEnabled:!0})}),GAME_NAME.logger.log("UserInterface","unTargetTiles(): enabled all cells"),this},d.prototype.renderTarget=function(a){var b;return b=this.model.get("targetHtml")||"",this.$targetEl.html(b),this},d.prototype.changeMana=function(a){var b;return b=this.model.get("manaHtml"),this.$manaEl.html(b),this},d}(Backbone.View)," ========================================================================    \n\nModel    \n\n======================================================================== ",GAME_NAME.Models.UserInterface=function(b){function d(){this.initialize=a(this.initialize,this),d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.defaults={target:void 0,targetHtml:"",manaHtml:""},d.prototype.initialize=function(){return this},d}(Backbone.Model)}.call(this),function(){" ========================================================================    \nmap.coffee\n\nContains the definition for map, which is retrieved from server and made\nup of cells.  A Map object is made up of map cells and the Map\nis owned by the Game object\n\n======================================================================== "," ========================================================================    \nAdd logging types\n======================================================================== ";var a=function(a,b){return function(){return a.apply(b,arguments)}},b=Object.prototype.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};GAME_NAME.logger.options.log_types.push("Map"),GAME_NAME.logger.options.setup_log_types()," ========================================================================    \n\nModel    \n\n======================================================================== ",GAME_NAME.Models.Map=function(b){function d(){this.setupCells=a(this.setupCells,this),this.randomizeMap=a(this.randomizeMap,this),this.initialize=a(this.initialize,this),d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.defaults={name:"Faydwer",map:[[{},{}],[{},{}]],cells:{}},d.prototype.initialize=function(){return"A Map object is created in the Game class",this.set({map:this.randomizeMap()}),this.setupCells({map:this.map}),this},d.prototype.randomizeMap=function(){var a,b,c,d,e,f;c=[];for(a=0;a<=16;a++){e=[];for(b=0;b<=8;b++)d=Math.round(Math.random()*3),f={baseSprite:"terrain_"+Math.round(Math.random()*1),topSprite:[void 0,void 0,void 0,"rock"][d],canPass:["all","ground","ground","air"][d]},e.push(f);c.push(e)}return c},d.prototype.setupCells=function(a){"Setup the game cells.  This is called from init and\nthe cells are setup based on this model's map array\nTakes in a array of cells ";var b,c,d,e,f,g,h,i,j,k;a=a||{},a.map=a.map||this.get("map"),d=0,e=0,c={},k=a.map;for(g=0,i=k.length;g<i;g++){f=k[g],e=0;for(h=0,j=f.length;h<j;h++)b=f[h],c[d+","+e]=new GAME_NAME.Models.Cell({name:"cell_"+d+","+e,x:d,y:e,baseSprite:b.baseSprite,topSprite:b.topSprite,type:b.type,canPass:b.canPass}),e++;d++}return this.set({cells:c}),GAME_NAME.logger.Map("MAP: cells set, cells: ",this.get("cells"))},d}(Backbone.Model)}.call(this),function(){" ========================================================================    \nplayer.coffee\n\nContains the class (view and model) definitions for the player class\n\n======================================================================== "," ========================================================================    \nAdd logging types\n======================================================================== ";var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b},c=function(a,b){return function(){return a.apply(b,arguments)}};GAME_NAME.logger.options.log_types.push("Player"),GAME_NAME.logger.options.setup_log_types()," ========================================================================    \n\nVIEW \n\n======================================================================== ",GAME_NAME.Views.Player=function(a){function c(){c.__super__.constructor.apply(this,arguments)}return b(c,a),"The Player view.  This is basically just an empty class, as \nthere are no elements directly tied to the player",c}(Backbone.View)," ========================================================================    \n\nModel    \n\n======================================================================== ",GAME_NAME.Models.Player=function(a){function d(){this.updateManaUI=c(this.updateManaUI,this),this.turnEnd=c(this.turnEnd,this),this.turnBegin=c(this.turnBegin,this),this.updateHealthFromCreature=c(this.updateHealthFromCreature,this),this.initialize=c(this.initialize,this),d.__super__.constructor.apply(this,arguments)}return b(d,a),d.prototype.defaults={name:"Soandso",id:"some_long_string",health:20,mana:3,totalMana:3,baseMana:3,regenRate:.5,target:{},spells:[],turnsEnded:0,creature:void 0},d.prototype.initialize=function(){return this.on("turn:start",this.turnStart),this.on("turn:end",this.turnEnd),this.on("change:mana",this.updateManaUI),this.get("creature")&&this.get("creature").on("change:health",this.updateHealthFromCreature),this},d.prototype.updateHealthFromCreature=function(){return this.set({health:this.get("creature").get("health")}),this},d.prototype.turnBegin=function(){return this},d.prototype.turnEnd=function(){return this.set({turnsEnded:this.get("turnsEnded")+1}),this.set({mana:this.get("totalMana")}),this},d.prototype.updateManaUI=function(){return GAME_NAME.game&&GAME_NAME.game.get("activePlayer")===this&&GAME_NAME.game.get("userInterface").set({manaHtml:this.get("mana")}),this},d}(Backbone.Model),GAME_NAME.Collections.Players=function(a){function c(){c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.model=GAME_NAME.Models.Player,c}(Backbone.Collection)}.call(this),function(){" ========================================================================    \nrenderer.coffee\n\nHandles the actual drawing / rendering of the game\n\n======================================================================== "," ========================================================================    \nAdd logging types\n======================================================================== ";var a=function(a,b){return function(){return a.apply(b,arguments)}},b=Object.prototype.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};GAME_NAME.logger.options.log_types.push("Render"),GAME_NAME.logger.options.setup_log_types()," ========================================================================    \n\nRenderer\n\n======================================================================== ",GAME_NAME.Views.Renderer=function(b){function d(){this.drawCreature=a(this.drawCreature,this),this.drawMap=a(this.drawMap,this),this.drawCreatures=a(this.drawCreatures,this),this.render=a(this.render,this),this.renderUI=a(this.renderUI,this),this.initialize=a(this.initialize,this),d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.el="#canvas_game",d.prototype.events={},d.prototype.initialize=function(){return"Create the renderer view.  This should be called from game.js",this.options.game===void 0?(GAME_NAME.logger.error("ERROR! renderer view: options.game not set, pass in game!"),!1):(this.model=new GAME_NAME.Models.Renderer({game:this.options.game}),this.d3El=d3.select("#game_canvas"),this)},d.prototype.renderUI=function(){var a,b,c,d,e,f,g,h,i;e=this.model.get("game").get("players"),a=this.model.get("game").get("activePlayer"),c=[];for(b in e)d=e[b],c.push("<li>"+d.get("name")+": "+d.get("health")+"HP </li>");$("#game_player_info_wrapper .player_list").html(c.join("")),h=[],i=a.get("spells");for(b in i)f=i[b],g=(new GAME_NAME.Views.Spell({model:f})).render();return this},d.prototype.render=function(){return"This draws all the elements of the game to the screen",$(this.d3El.node()).empty(),this.drawMap({map:this.model.get("game").get("map")}),this.drawCreatures(),this},d.prototype.drawCreatures=function(){"Draw all the creatures for each player";var a,b,c,d,e,f,g,h,i,j=this;this.creaturesGroup=this.d3El.append("svg:g").attr("class","creatures_group"),e=this.model.get("game").get("players");for(c in e){d=e[c],b=d.get("creatures"),i=b.models,f=function(a){return j.drawCreature({creature:a})};for(g=0,h=i.length;g<h;g++)a=i[g],f(a)}return this},d.prototype.drawMap=function(a){"This draws the map by rendering each map tile individually";var b,c,d,e,f;this.mapGroup=this.d3El.append("svg:g").attr("class","game_map"),e=this.mapGroup.append("svg:g").attr("class","map_tiles"),c=this.model.get("game").get("map").get("cells");for(d in c)f=c[d],b=new GAME_NAME.Views.Cell({model:f,cellSize:this.model.get("cellSize"),group:e}),b.render({renderer:this.model});return GAME_NAME.logger.Render("renderer: map rendering complete")},d.prototype.drawCreature=function(a){return"Draws the passed in entity on the screen. Params expects a\ncreature model to be passed in",a=a||{},a.creature===void 0?(GAME_NAME.logger.error("ERROR! renderer view: drawCreature(): creature not passed in"),!1):(a.creature.get("view")||a.creature.set({view:new GAME_NAME.Views.Creature({model:a.creature,game:this.model.get("game"),group:this.creaturesGroup})}),a.creature.get("view").render({renderer:this,group:this.creaturesGroup}),this)},d}(Backbone.View)," ========================================================================    \n\nModel\n\n======================================================================== ",GAME_NAME.Models.Renderer=function(b){function d(){this.initialize=a(this.initialize,this),d.__super__.constructor.apply(this,arguments)}return c(d,b),"Keeps track of the renderer state",d.prototype.defaults={cellSize:{height:48,width:48},sprites:{terrain_0:"/static/image/sprites/map/grass_bg.png",terrain_1:"/static/image/sprites/map/blue_grass.jpg",terrain_2:"/static/image/sprites/map/road.jpg",rock:"/static/image/sprites/map/rock.png"
,creature_dragoon:"/static/image/sprites/creatures/dragoon.png"}},d.prototype.initialize=function(){return"When this renderer model is instaniated, store a reference to the\ngame object",this},d}(Backbone.Model)}.call(this),function(){" ========================================================================    \nspells.coffee\n\nContains the class definitions spells\n    Spells instaniated from server\n\n======================================================================== "," ========================================================================    \nAdd logging types\n======================================================================== ";var a=function(a,b){return function(){return a.apply(b,arguments)}},b=Object.prototype.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};GAME_NAME.logger.options.log_types.push("Spell"),GAME_NAME.logger.options.setup_log_types()," ========================================================================    \n\nView\n\n======================================================================== ",GAME_NAME.Views.Spell=function(b){function d(){this.spellCast=a(this.spellCast,this),this.updateUI=a(this.updateUI,this),this.click=a(this.click,this),this.render=a(this.render,this),this.initialize=a(this.initialize,this),d.__super__.constructor.apply(this,arguments)}return c(d,b),"Handles the spell renderering / user interface",d.prototype.type="li",d.prototype.initialize=function(){var a=this;return this.options.model===void 0?(GAME_NAME.logger.error("ERROR","creature view init(): params not properly passed in"),!1):(this.model=this.options.model,this.userInterface=GAME_NAME.game.get("userInterface"),this.el=$('<li class="button">'+this.model.get("name")+"</li>"),this.el.click(this.click),this.model.on("spell:cast",this.spellCast),GAME_NAME.game.get("activePlayer").on("turn:end",function(){return a.model.set({timesCastThisTurn:0})}),this)},d.prototype.render=function(){return $(".spells").append(this.el),this},d.prototype.click=function(){return this.model.trigger("spell:cast"),this},d.prototype.updateUI=function(){return this},d.prototype.spellCast=function(){var a,b,c,d,e;return a=GAME_NAME.game.get("activePlayer"),a.get("mana")<this.model.get("cost")?(this.userInterface.trigger("spell:insufficientMana"),GAME_NAME.logger.Spell("Could not cast spell, not enough mana","Player mana:",GAME_NAME.game.get("activePlayer").get("mana"),"Spell cost:",this.model.get("cost")),!1):(e=this.userInterface.get("target"),e?(c=this.model.get("contract")({model:e,activePlayer:GAME_NAME.game.get("activePlayer")}),typeof c=="boolean"?(b=c,d="Cannot cast spell"):(b=c.canCast||!1,d=c.message||"Cannot cast spell"),e&&b?(a.set({mana:a.get("mana")-this.model.get("cost")}),this.model.trigger("spell:castSuccess"),e.trigger("spell:cast",{spell:this.model})):(this.userInterface.trigger("spell:cannotCast",{message:d}),GAME_NAME.logger.Spell("Cannot cast "+this.model.get("name"),"spell contract returned false","message: ",d)),this):(this.userInterface.trigger("spell:noTarget"),GAME_NAME.logger.Spell("spellCast(): Interaction model has no target"),!1))},d}(Backbone.View)," ========================================================================    \n\nModel    \n\n======================================================================== ",GAME_NAME.Models.Spell=function(b){function d(){this.castSuccess=a(this.castSuccess,this),this.initialize=a(this.initialize,this),d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.defaults={name:"Magic Missle",cost:1,target:{},totalTimesCast:0,timesCastThisTurn:0,effect:function(a){return this},contract:function(a){return{canCast:!0,message:""}}},d.prototype.initialize=function(){return this.on("spell:castSuccess",this.castSuccess),this},d.prototype.castSuccess=function(){return this.set({totalTimesCast:this.get("totalTimesCast")+1}),this.set({timesCastThisTurn:this.get("timesCastThisTurn")+1}),this},d}(Backbone.Model)," ========================================================================    \n\nColections\n\n======================================================================== ",GAME_NAME.Collections.Spells=function(a){function b(){b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.model=GAME_NAME.Models.Spell,b}(Backbone.Collection)}.call(this),function(){" ========================================================================    \ninit.js\n----------------------\nSets up page / UI related stuff and \n========================================================================";var a,b,c,d,e=this;GAME_NAME.init=function(){"Kick off the game creation";var a,b,c,d,f,g;return d=function(a){var b,c,d;return a=a||{},c=a.model,c.get("className")!=="creature"?(GAME_NAME.logger.log("Spell","Could not cast magic missle. Invalid target"),!1):(c.dealDamage(1),b=GAME_NAME.Models.Renderer.prototype.defaults.cellSize,d=a.target.append("svg:circle").attr("r",0).attr("cx",b.width/2).attr("cy",b.height/2).style("opacity",.8),d.transition().duration(1e3).attr("r",40).style("fill","#dd2222").each("end",function(){return d.transition().duration(700).style("fill","#ff0000").attr("r",0).each("end",function(){return d.transition().attr("r",0).style("fill","none").remove()})}))},g=function(a){var b,c,d,e;return a=a||{},c=a.model,b=GAME_NAME.Models.Renderer.prototype.defaults.cellSize,e=a.target.append("svg:circle").attr("r",b.width/1.8).attr("cx",b.width/2).attr("cy",b.height/2).style("opacity",.9).style("fill","#6699cc").transition().duration(1e3).attr("r",0).style("fill","#336699").each("end",function(){return e.transition().duration(700).style("fill","#ffffff").attr("r",0).each("end",function(){return e.transition().attr("r",0).style("fill","none").remove()})}),GAME_NAME.game.get("userInterface").set({target:void 0}),d=new GAME_NAME.Models.Creature({name:Math.random().toString(32),health:10,location:{x:c.get("x"),y:c.get("y")},moves:2,movesLeft:0}),GAME_NAME.game.get("activePlayer").get("creatures").add(d),GAME_NAME.game.get("renderer").drawCreature({creature:d})},b=new GAME_NAME.Models.Creature({name:"Enoex",health:20,location:{x:2,y:1}}),a=new GAME_NAME.Models.Creature({name:"Enjalot",health:20,location:{x:15,y:1}}),c={players:{enoex:new GAME_NAME.Models.Player({name:"Enoex",id:"402190r90war",spells:{magic_missile:new GAME_NAME.Models.Spell({name:"Magic Missile",effect:d,contract:function(a){var b;return a.model.get("className")!=="creature"?(b={canCast:!1,message:"Can only cast on creatures or players"},b):!0}}),summon_knight:new GAME_NAME.Models.Spell({name:"Summon Creature",effect:g,contract:function(a){return a.model.get("className")!=="cell"?!1:!0}})},creatures:new GAME_NAME.Collections.Creatures([b]),creature:b}),enjalot:new GAME_NAME.Models.Player({name:"Enjalot",id:"u90r2h180f80n",spells:{},creatures:new GAME_NAME.Collections.Creatures([a]),creature:a})}},c.activePlayer=c.players.enoex,GAME_NAME.game=new GAME_NAME.Models.Game(c),f=GAME_NAME.game.get("renderer"),f.renderUI(),f.render(),e}," ========================================================================    \nCall init\n========================================================================",d=GAME_NAME.Models.Renderer.prototype.defaults.sprites;for(a in d)c=d[a],b=new Image,b.src=c;$(document).ready(function(){return GAME_NAME.templates.target_creature_mine=$("#template_ui_target_creature_mine").html(),GAME_NAME.templates.target_creature_theirs=$("#template_ui_target_creature_theirs").html(),GAME_NAME.templates.target_cell=$("#template_ui_target_cell").html(),GAME_NAME.init()})}.call(this);